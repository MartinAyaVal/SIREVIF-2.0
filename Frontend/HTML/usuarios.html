<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/Frontend/CSS/usuarios.css">
    <link rel="stylesheet" href="/Frontend/CSS/formularioUsuarios.css">
    <link rel="stylesheet" href="/Frontend/CSS/barraLateral.css">
    <link rel="icon" href="/Frontend/images/logoAlcaldia.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <title>SIREVIF 2.0 - Usuarios</title>
</head>
<body>
    <header id="barra" class="barra">
        <img id="menuHamburguesa" class="hamburguesa" src="/Frontend/images/hamburguesa.png" alt="Men√∫">
        <img id="logo" class="logo" src="/Frontend/images/logoAlcaldia.png" alt="Logo">
        <p id="titulo" class="titulo">SIREVIF 2.0</p>
        <p id="nombreUsuarioHeader" class="texto">Cargando...</p>
        <p id="comisariaUsuarioHeader" class="texto">Cargando...</p>
        <nav>
            <a id="boton" title="Medidas de Protecci√≥n" href="index.html" class="botonBarra">
                <img class="imgBarra" src="/Frontend/images/medidas.png" alt="Medidas">
                Medidas de Protecci√≥n 
            </a>
            <a id="boton" title="Estad√≠sticas" href="estadisticas.html" class="botonBarra">
                <img class="imgBarra" src="/Frontend/images/estadisticas.png" alt="Estad√≠sticas">
                Estad√≠sticas
            </a>
            <a id="botonUsuarios" title="Usuarios" href="usuarios.html" class="actual">
                <img class="imgBarra" src="/Frontend/images/usuarios.png" alt="Usuarios">
                Usuarios
            </a>
            <a id="boton" title="Mi Cuenta" href="miCuenta.html" class="botonBarra">
                <img class="imgBarra" src="/Frontend/images/usuario.png" alt="Mi Cuenta">
                Mi cuenta
            </a>
        </nav>
        <a id="logoutBtn" class="botonSalir" title="Cerrar Sesi√≥n" href="#">
            <img class="imgBarra" src="/Frontend/images/cerrar-sesion.png" alt="Cerrar sesi√≥n">
            Cerrar Sesi√≥n
        </a>
    </header>

    <h1 class="tituloUsuarios">Usuarios Registrados</h1>
    <button class="a√±adir" id="abrirFormulario">Crear Nuevo Usuario <img src="/Frontend/images/a√±adir.png" alt="A√±adir"></button>
    
    <!-- Di√°logo de confirmaci√≥n para cerrar sesi√≥n -->
    <div id="divCerrarSesion" class="fondoCerrarSesion" style="display: none;">
        <div class="cerrarSesion">
            <img src="/Frontend/images/logoAlcaldia.png" class="imgCerrarSesion" alt="Logo">
            <p>¬øEst√° seguro que desea cerrar sesi√≥n?</p>
            <div class="botonesCerrarSesion">
                <button id="cerrarSesion" class="boton1cerrarSesion">S√≠, cerrar sesi√≥n</button>
                <button id="cancelarCerrarSesion" class="boton2cerrarSesion">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Secciones para organizar usuarios por comisar√≠a -->
    <div class="seccionaes">
        <div class="seccionUsuarios">
            <h2 class="tituloSec">Administrador</h2>
            <div class="usuarios"></div>
        </div>

        <div class="seccionUsuarios">
            <h2 class="tituloSec">Usuarios Comisar√≠a Primera</h2>
            <div class="usuarios"></div>
        </div>

        <div class="seccionUsuarios">
            <h2 class="tituloSec">Usuarios Comisar√≠a Segunda</h2>
            <div class="usuarios"></div>
        </div>

        <div class="seccionUsuarios">
            <h2 class="tituloSec">Usuarios Comisar√≠a Tercera</h2>
            <div class="usuarios"></div>
        </div>

        <div class="seccionUsuarios">
            <h2 class="tituloSec">Usuarios Comisar√≠a Cuarta</h2>
            <div class="usuarios"></div>
        </div>

        <div class="seccionUsuarios">
            <h2 class="tituloSec">Usuarios Comisar√≠a Quinta</h2>
            <div class="usuarios"></div>
        </div>

        <div class="seccionUsuarios">
            <h2 class="tituloSec">Usuarios Comisar√≠a Sexta</h2>
            <div class="usuarios"></div>
        </div>
    </div>

    <!-- Formulario overlay para crear/editar usuarios -->
    <div id="formularioOverlay" class="fondoF" style="display: none;">
        <div class="formulario">
            <div class="headerF">
                <img title="Cancelar Registro" class="botonCancelar" src="/Frontend/images/salir.png" alt="Cancelar">
                <h2>Registrar nuevo Usuario</h2>
            </div>
            
            <form id="formularioUsuarios">
                <div class="seccionF">
                    <!-- Primera fila: Nombre, Documento, Cargo -->
                    <table class="tablaF">
                        <tr>
                            <td>Nombre completo:</td>
                            <td>N√∫mero de Documento</td>
                            <td>Cargo:</td>
                        </tr>
                        <tr>
                            <td>
                                <input autocomplete="off" type="text" name="nombreUsuario" id="nombreUsuario">
                                <p class="mensaje">- El <strong>Nombre completo</strong> es requerido</p>
                            </td>
                            <td>
                                <input autocomplete="off" type="number" name="documentoUsuario" id="documentoUsuario">
                                <p class="mensaje">- El <strong>N√∫mero de documento</strong> es requerido</p>
                                <p class="mensaje">- El m√≠nimo de caracteres es de 7</p>
                            </td>
                            <td>
                                <input autocomplete="off" type="text" name="cargoUsuario" id="cargoUsuario">
                                <p class="mensaje">- El <strong>Cargo</strong> es requerido</p>
                            </td>
                        </tr>
                    </table>
                    
                    <!-- Segunda fila: Correo, Tel√©fono, Rol -->
                    <table class="tablaF">
                        <tr>
                            <td>Correo:</td>
                            <td>Tel√©fono:</td>
                            <td>Comisar√≠a/Rol:</td>
                        </tr>
                        <tr>
                            <td>
                                <input class="correo" autocomplete="off" type="text" name="correoUsuario" id="correoUsuario">
                                <p class="mensaje">- El <strong>Correo</strong> es requerido</p>
                                <p class="mensaje">- Ingrese un correo v√°lido</p>
                            </td>
                            <td>
                                <input autocomplete="off" type="number" name="telefonoUsuario" id="telefonoUsuario">
                                <p class="mensaje">- El <strong>Tel√©fono</strong> es requerido</p>
                                <p class="mensaje">- El m√≠nimo de caracteres es de 10</p>
                            </td>
                            <td>
                                <select id="comisariaUsuario" name="comisariaUsuario">
                                    <option value="">- - Seleccione - -</option>
                                    <option value="Comisar√≠a Primera">Comisar√≠a Primera</option>
                                    <option value="Comisar√≠a Segunda">Comisar√≠a Segunda</option>
                                    <option value="Comisar√≠a Tercera">Comisar√≠a Tercera</option>
                                    <option value="Comisar√≠a Cuarta">Comisar√≠a Cuarta</option>
                                    <option value="Comisar√≠a Quinta">Comisar√≠a Quinta</option>
                                    <option value="Comisar√≠a Sexta">Comisar√≠a Sexta</option>
                                    <option value="Administrador">Administrador</option>
                                </select>
                                <p class="mensaje">- Seleccione alguna de las opciones.</p>
                            </td>
                        </tr>
                    </table>
                    
                    <!-- Tercera fila: Contrase√±a -->
                    <table class="tablaF">
                        <tr>
                            <td></td>
                            <td>Contrase√±a:</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="position: relative; flex: 1;">
                                        <input autocomplete="off" type="password" id="contrase√±aUsuario" 
                                            style="width: 100%; box-sizing: border-box; padding-right: 60px;">
                                        <div style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); display: flex; gap: 5px;">
                                            <img src="/Frontend/images/ojo.png" class="ver" id="mostrar" style="display: inline; cursor: pointer;" alt="Mostrar">
                                            <img src="/Frontend/images/invisible.png" class="ver" id="ocultar" style="display: none; cursor: pointer;" alt="Ocultar">
                                        </div>
                                    </div>
                                </div>
                                <p class="mensaje">- La <strong>Contrase√±a</strong> es requerida</p>
                            </td>
                            <td>
                                <button type="button" id="generarContrase√±aBtn" class="btn-generar-contrase√±a" 
                                    style="background: #4CAF50; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 14px; white-space: nowrap; height: fit-content;">
                                    Generar Contrase√±a
                                </button>
                            </td>
                        </tr>
                    </table>
                </div>
                
                <!-- Bot√≥n de acci√≥n -->
                <div class="boton-container">
                    <button class="botonGuardar" id="crearUsuario" type="button">Crear</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/Frontend/JS/barraLateral.js"></script>
    <script src="/Frontend/JS/infoBarra.js"></script>
    <script src="/Frontend/JS/timeout.js"></script>
    
    <!-- Archivo combinado de usuarios -->
    <script src="/Frontend/JS/usuarios.js"></script>
    
    <!-- Script de inicializaci√≥n -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ DOM cargado - Inicializando p√°gina de usuarios...');
        
        // Verificar token
        const token = localStorage.getItem('sirevif_token');
        const usuario = localStorage.getItem('sirevif_usuario');
        
        if (!token || !usuario) {
            console.error('‚ùå No hay sesi√≥n activa');
            alert('No hay sesi√≥n activa. Redirigiendo al login...');
            window.location.href = '/Frontend/HTML/login.html';
            return;
        }
        
        // Configurar logout
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('divCerrarSesion').style.display = 'flex';
            });
        }
        
        const cancelarCerrarBtn = document.getElementById('cancelarCerrarSesion');
        if (cancelarCerrarBtn) {
            cancelarCerrarBtn.addEventListener('click', function() {
                document.getElementById('divCerrarSesion').style.display = 'none';
            });
        }
        
        const confirmarCerrarBtn = document.getElementById('cerrarSesion');
        if (confirmarCerrarBtn) {
            confirmarCerrarBtn.addEventListener('click', function() {
                if (typeof cerrarSesion === 'function') {
                    cerrarSesion();
                } else {
                    localStorage.removeItem('sirevif_token');
                    localStorage.removeItem('sirevif_usuario');
                    window.location.href = '/Frontend/HTML/login.html';
                }
            });
        }
        
        // Inicializar sistema de usuarios
        setTimeout(() => {
            if (typeof inicializarUsuarios === 'function') {
                console.log('üîÑ Inicializando sistema de usuarios...');
                inicializarUsuarios();
            } else {
                console.error('‚ùå Error: funci√≥n inicializarUsuarios no encontrada');
                // Mostrar error silencioso en consola, no al usuario
            }
        }, 300);
    });
    
    // Funci√≥n global para debug (solo disponible en consola)
    window.debugUsuarios = function() {
        console.log('=== DEBUG USUARIOS ===');
        console.log('Token:', localStorage.getItem('sirevif_token') ? '‚úì Presente' : '‚úó Ausente');
        console.log('Usuario:', localStorage.getItem('sirevif_usuario'));
        console.log('Funciones disponibles:');
        console.log('  - renderizarUsuarios:', typeof renderizarUsuarios);
        console.log('  - cargarUsuarios:', typeof cargarUsuarios);
        console.log('  - inicializarUsuarios:', typeof inicializarUsuarios);
        console.log('=== FIN DEBUG ===');
    };
    </script>
</body>
</html>